<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>EyeGPT</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>

<div class="container">
    <h1>üëÅÔ∏è EyeGPT</h1>
    <p class="subtitle">AI-based cataract screening from anterior eye images</p>

    <!-- Upload -->
    <h3>Upload Image (Recommended)</h3>
    <form method="POST" enctype="multipart/form-data" id="uploadForm" class="upload-box">
        <input type="file" name="image" accept="image/*" required id="fileInput">
        <button type="submit">Analyze Image</button>
    </form>

    <!-- Camera -->
    <h3>Camera Capture (‚ö†Ô∏è Not Recommended)</h3>

    <div class="camera-warning">
        <strong>Warning:</strong> Camera-based analysis is highly unreliable due to
        glare, flash, auto-exposure, reflections, and distance issues.
        <br><br>
        <strong>Do NOT use camera results for screening.</strong>
        This feature is for <em>demonstration only</em>.
    </div>

    <label class="acknowledge">
        <input type="checkbox" id="ackCheckbox">
        I understand camera results are unreliable
    </label>

    <br><br>

    <button id="startCameraBtn" disabled>
        Enable Camera (Demo Only)
    </button>

    <div id="cameraSection" style="display:none;">
        <video id="video" autoplay></video>
        <button id="captureBtn">Capture Image</button>
        <canvas id="canvas" style="display:none;"></canvas>
    </div>

    <!-- Preview -->
    <div id="previewSection" style="display:none;">
        <h3>Preview</h3>
        <img id="previewImage" class="preview-img">
        <button id="submitPreviewBtn">Analyze Preview</button>
    </div>

    {% if error %}
    <div class="camera-warning">
        <strong>Image rejected:</strong> {{ error }}
    </div>
    {% endif %}

    {% if result %}
    <div class="result-card">
        <span class="badge {{ 'danger' if result.prediction=='Cataract' else 'safe' }}">
            {{ result.prediction }}
        </span>

        <p class="confidence">
            Confidence: <strong>{{ result.confidence }}%</strong>
        </p>

        <h3>EyeGPT Explanation</h3>
        <p class="explanation">{{ explanation }}</p>

        {% if gradcam %}
        <h3>Grad-CAM Visualization</h3>
        <img src="{{ url_for('static', filename=gradcam) }}" class="gradcam-img">
        {% endif %}
    </div>
    {% endif %}

    <p class="disclaimer">
        ‚ö†Ô∏è Educational & research use only. Not a medical diagnostic tool.
    </p>
</div>

<script src="{{ url_for('static', filename='camera.js') }}"></script>
</body>
</html>
