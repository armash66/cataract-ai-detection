<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>EyeGPT â€“ AI Vision Analysis</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <meta name="description"
          content="EyeGPT is an AI-assisted eye disease screening system for educational and research purposes only. Not a medical diagnostic tool.">

    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">

    <style>
        /* Image positioning */
        .image-frame {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 14px;
        }

        .image-frame img {
            max-width: 260px;
            width: 100%;
            border-radius: 8px;
            display: none;
        }

        /* Camera dropdown UX */
        .camera-dropdown {
            margin-top: 10px;
            padding: 12px;
            border: 1px dashed rgba(255,255,255,0.25);
            display: none;
        }

        .camera-actions {
            margin-top: 10px;
        }
    </style>
</head>
<body>

<div class="app basic-ui">

    <!-- HEADER -->
    <header class="header">
        <div class="header-left">
            <h1>EyeGPT</h1>
            <span class="subtitle">AI Vision Analysis System</span>
        </div>
        <div class="header-right">
            <span>Status:</span>
            <span id="systemStatus">IDLE</span>
        </div>
    </header>

    <!-- MAIN -->
    <main class="content">

        <!-- =========================
             RESULT PANEL
        ========================== -->
        <section class="panel result-panel">

            <h2>Step 2: AI screening result</h2>

            {% if result %}
            <div class="result-box">

                <div class="result-row">
                    <span class="result-name">{{ result.prediction }}</span>
                    <span class="result-confidence">{{ result.confidence }}%</span>
                </div>

                <div class="confidence-ring">
                    <svg width="120" height="120">
                        <circle cx="60" cy="60" r="50"></circle>
                        <circle
                            cx="60"
                            cy="60"
                            r="50"
                            id="confidenceCircle"
                            data-value="{{ result.confidence }}">
                        </circle>
                    </svg>
                </div>

                <p class="confidence-explain">
                    <strong>What does this mean?</strong><br>
                    Confidence reflects how strongly the model matched learned visual patterns.
                    It does <em>not</em> indicate disease severity.
                </p>

                <div class="image-frame">
                    <img
                        id="mainImage"
                        src="{{ url_for('static', filename=original_image) }}"
                        alt="Eye image used for AI screening"
                        style="display:block;">
                </div>

                {% if gradcam %}
                <button
                    id="gradToggleBtn"
                    class="secondary-btn"
                    data-gradcam="{{ url_for('static', filename=gradcam) }}"
                    style="margin-top:10px;">
                    Toggle visual explanation (Grad-CAM)
                </button>

                <div style="margin-top:10px;">
                    <label for="overlaySlider">Overlay opacity</label>
                    <input type="range" id="overlaySlider" min="0" max="100" value="100">
                </div>

                <div class="gradcam-explain">
                    <strong>How to read this visualization</strong>
                    <ul>
                        <li>Warmer regions influenced the model more</li>
                        <li>This is not a clinical highlight</li>
                        <li>Provided for transparency & research only</li>
                    </ul>
                </div>
                {% endif %}

            </div>
            {% else %}
            <div class="result-box muted" style="text-align:center;">
                Upload an eye image to begin AI-assisted screening.
            </div>
            {% endif %}

            <p class="disclaimer">
                Educational & research use only. This system is not a medical diagnostic tool.
            </p>
        </section>

        <!-- =========================
             INPUT PANEL
        ========================== -->
        <section class="panel input-panel">

            <h2>Step 1: Upload eye image</h2>

            <form method="POST"
                  enctype="multipart/form-data"
                  id="uploadForm">

                <input type="file" name="image" id="fileInput" required>
                <button type="submit" class="primary-btn">Scan Image</button>
            </form>

            <!-- CAMERA BUTTON -->
            <button id="cameraToggleBtn"
                    class="secondary-btn"
                    style="margin-top:16px;">
                Camera (Experimental)
            </button>

            <!-- CAMERA DROPDOWN / CARD -->
            <div id="cameraDropdown" class="camera-dropdown">

                <p class="warning-text">
                    Camera-based screening is unreliable.
                </p>

                <label>
                    <input type="checkbox" id="ackCheckbox">
                    I understand the limitations
                </label>

                <div class="camera-actions">
                    <button id="startCameraBtn" disabled>
                        Activate Camera
                    </button>
                </div>

                <!-- CAMERA FEED + CAPTURE MOVED INSIDE -->
                <div id="cameraSection" class="camera-hidden">

            <div class="camera-frame">
                <video id="video" autoplay muted playsinline></video>
            </div>

            <div class="camera-controls">
                <button id="captureBtn">Capture</button>
                <button id="stopCameraBtn">Stop</button>
            </div>

            <canvas id="canvas" hidden></canvas>
        </div>


            </div>

            <img id="previewImage" style="display:none;">
        </section>

    </main>
</div>

<!-- ===============================
     DROPDOWN TOGGLE (UI ONLY)
================================ -->
<script>
document.addEventListener("DOMContentLoaded", () => {
    const cameraBtn = document.getElementById("cameraToggleBtn");
    const dropdown = document.getElementById("cameraDropdown");

    if (cameraBtn && dropdown) {
        cameraBtn.addEventListener("click", () => {
            dropdown.style.display =
                dropdown.style.display === "block" ? "none" : "block";
        });
    }
});
</script>

<!-- SCRIPTS -->
<script src="{{ url_for('static', filename='camera.js') }}"></script>
<script src="{{ url_for('static', filename='ui.js') }}"></script>

</body>
</html>
